
<html>
    <style>
        tr, td {
        padding: 0.6rem;
        border: 2px solid black
        }

        table:hover {
        cursor: pointer;
        }
    </style>


    <body style="padding: 10%;">
        Name:<input type='text' id='name' value='Apple'></input>
        <button onclick='OnShapeExtraction()'>Extract Shape</button>
    </body>

    <script>
        var table;
        var nameItem;

        window.onload = function () {
            generate_table(10,10);
            table = document.getElementById('grid');
            nameItem = document.getElementById('name');
            AddListener();
        }

        function AddListener(){
            table.addEventListener('click', function(e) {
               OnGridClick(e.target.parentElement.rowIndex, e.target.cellIndex);
            }, false);     
        }

        function generate_table(x,y) {
            // get the reference for the body
            var body = document.getElementsByTagName("body")[0];

            // creates a <table> element and a <tbody> element
            var tbl = document.createElement("table");
            var tblBody = document.createElement("tbody");

            // creating all cells
            for (var i = 0; i < x; i++) {
                // creates a table row
                var row = document.createElement("tr");

                for (var j = 0; j < y; j++) {
                // Create a <td> element and a text node, make the text
                // node the contents of the <td>, and put the <td> at
                // the end of the table row
                var cell = document.createElement("td");
                var cellText = document.createTextNode(i+","+j);
                cell.appendChild(cellText);
                row.appendChild(cell);
                }

                // add the row to the end of the table body
                tblBody.appendChild(row);
            }

            // put the <tbody> in the <table>
            tbl.appendChild(tblBody);
            // appends <table> into <body>
            body.appendChild(tbl);
            // sets the border attribute of tbl to 2;
            tbl.setAttribute("border", "2");

            tbl.id = "grid";
        }

        function OnGridClick(x, y){
            //Dont change the order pls doggleDot, registerInMap
            ToggleDotInCoordenate(x, y);
            RegisterCoordenatesInMap(x, y);
        }

        var isPrintAction = true;
        function ToggleDotInCoordenate(x, y){
            var cell = table.rows[x].cells[y];
            var cellColor = cell.style.backgroundColor

            if(cellColor == "red"){
                cell.style.backgroundColor = "white";
                isPrintAction = false;
            }
            else{
                cell.style.backgroundColor = "red";
                isPrintAction = true;
            }
        }

        var shapeCoordenates = [];
        function RegisterCoordenatesInMap(x, y){
            if(isPrintAction){
                shapeCoordenates[x+","+y] = {x,y};
            }
            else{
                delete shapeCoordenates[x+","+y]; 
            }
            console.log(shapeCoordenates);
        }

        function OnShapeExtraction(){

            //Dont change the order pls: double array, localize, switch axis
            VectorToDoubleArray();
            LocalizeCoordenates();
            SwitchAxisToAnActualCoordenateSystem();
            
            var output = {
                itemName : nameItem.value,
                localCoordenatesX : switchedAxisCoordenatesX,
                localCoordenatesY : switchedAxisCoordenatesY
            };

            download(nameItem.value + ".json", JSON.stringify(output));
            //shapeCoordenates = [];
            _localCoordenatesX = [];
            _localCoordenatesY = [];
            localizedCoordenatesX = [];
            localizedCoordenatesY = [];
            switchedAxisCoordenatesX = [];
            switchedAxisCoordenatesY = [];
        }


        var _localCoordenatesX = [];
        var _localCoordenatesY = [];
        function VectorToDoubleArray(){
            for(var i=0; i<Object.keys(shapeCoordenates).length; i++){
                _localCoordenatesX[i] = shapeCoordenates[ Object.keys(shapeCoordenates)[i] ].x;
                _localCoordenatesY[i] = shapeCoordenates[ Object.keys(shapeCoordenates)[i] ].y;
            }
            console.log("VECTOR TO DOUBLE ARRAY: ");
            console.log(_localCoordenatesX)
            console.log(_localCoordenatesY)
       }


        var localizedCoordenatesX = [];
        var localizedCoordenatesY = [];
        var minX;
        var minY;
        var maxX;
        var maxY;
        function LocalizeCoordenates(){
            minX = 999;
            minY = 999;
            maxX = 0;
            maxY = 0;

            for(var i=0; i<_localCoordenatesY.length; i++){
                if(_localCoordenatesX[i] < minX){
                    minX =  _localCoordenatesX[i];
                }
                if(_localCoordenatesY[i] < minY){
                    minY =  _localCoordenatesY[i];
                }

                if(_localCoordenatesX[i] > maxX){
                    maxX =  _localCoordenatesX[i];
                }
                if(_localCoordenatesY[i] > maxY){
                    maxY =  _localCoordenatesY[i];
                }
           }

            for(var i=0; i<_localCoordenatesY.length; i++){
                localizedCoordenatesX[i] = _localCoordenatesX[i] - minX;
                localizedCoordenatesY[i] = _localCoordenatesY[i] - minY;
            }

            console.log("LOCALIZED TO MIN VALUE: ");
            console.log("minX " + minX + "; minY " + minY)
            console.log("maxX " + maxX + "; maxY " + maxY)
            console.log(localizedCoordenatesX)
            console.log(localizedCoordenatesY)

        }

        var switchedAxisCoordenatesX = [];
        var switchedAxisCoordenatesY = [];
        function SwitchAxisToAnActualCoordenateSystem(){
            //Flip axis. This actually mirors coordenates by 45 degrees
            var maxY = 0;
            for(var i=0; i<_localCoordenatesY.length; i++){
                switchedAxisCoordenatesX[i] = localizedCoordenatesY[i];
                switchedAxisCoordenatesY[i] = localizedCoordenatesX[i];

                if(switchedAxisCoordenatesY[i] > maxY){
                    maxY =  switchedAxisCoordenatesY[i];
                }
            }

            //Miror y axis. Both instructions actually rotate the coordenates counteclockwise
            // and that can be seen as switching from row-cols system to x-y cartesian system
            for(var i=0; i<_localCoordenatesY.length; i++){
                switchedAxisCoordenatesY[i] = maxY - switchedAxisCoordenatesY[i];
            }
           
            console.log("AXIS SWITCHED: ");
            console.log(switchedAxisCoordenatesX)
            console.log(switchedAxisCoordenatesY)
       }


        function download(filename, text) {
            var element = document.createElement('a');
            element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
            element.setAttribute('download', filename);

            element.style.display = 'none';
            document.body.appendChild(element);

            element.click();

            document.body.removeChild(element);
        }
    </script>
</html>